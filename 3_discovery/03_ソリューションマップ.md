# 03 ä»®èª¬é§†å‹•: ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—ï¼ˆAIPMãƒãƒƒã‚«ã‚½ãƒ³ï¼‰

## æœ€åˆã«è³ªå•ï¼ˆå®Ÿè¡Œå‰ã«å›ç­”ã—ã¦ãã ã•ã„ï¼‰
- å¯¾è±¡ãƒšãƒ«ã‚½ãƒŠã¨ä¸»è¦èª²é¡Œç¾¤ã¯ï¼Ÿï¼ˆå¿…é ˆãƒ»PRåŸºæº–ï¼‰
- PR1/PR2/PR3 ãã‚Œãã‚Œã¸ã®è§£æ±ºæ¡ˆï¼ˆå¿…é ˆãƒ»1ã¤ãšã¤ï¼‰
- å„è§£æ±ºæ¡ˆãŒä¸»ã«åŠ¹ããƒ•ã‚§ãƒ¼ã‚ºï¼ˆä»»æ„: åˆ©ç”¨å‰/åˆ©ç”¨ä¸­/åˆ©ç”¨å¾Œï¼‰
- å‚è€ƒã¨ãªã‚‹é–¢é€£Activityï¼ˆä»»æ„: AIDã€‚ç©ºæ¬„ãªã‚‰è‡ªå‹•å€™è£œã‚’æ¡ç”¨ï¼‰

## ç›®çš„
Problemï¼ˆPRï¼‰åŸºæº–ã§è§£æ±ºæ¡ˆã‚’è¨­è¨ˆã—ã€PRâ†’SLâ†’A ã®æ¥ç¶šã§å¯è¦–åŒ–ã—ã¾ã™ã€‚

## å®Ÿè¡Œæ‰‹é †
```yaml
- trigger: "(ä»®èª¬é§†å‹•_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—|HypothesisSolutionMap)"
  priority: high
  steps:
    - name: "infer_defaults_from_thread"
      action: "analyze"
      data: ["{{thread_messages}}", "{{read_files(find_files(patterns=['**/problem_map.yaml','**/customer_problem_map.yaml','**/story_map.yaml']))}}"]
      instructions: |
        ç›´è¿‘ã®PR/Activity/Storyã®å¯¾å¿œã‹ã‚‰ã€PR1/PR2/PR3ã«å¯¾ã™ã‚‹æ—¢å®šã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³æ¡ˆã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
        å‡ºåŠ›ã¯ display ç”¨ãƒ†ã‚­ã‚¹ãƒˆã§ã€PRx: å€™è£œâ€¦ ã®å½¢å¼ã§ç°¡æ½”ã«ã€‚
      store_as: "auto_solution_hints"

    - name: "ingest_sense_focus"
      action: "analyze"
      data: [
        "{{read_files(find_files(patterns=['**/1_sense/07_ã‚ªãƒãƒãƒ¥ãƒ‹ãƒ†ã‚£ä»®èª¬æŠ½å‡º/sense_opportunities.yaml']))}}",
        "{{read_files(find_files(patterns=['**/1_sense/06_ãƒªã‚µãƒ¼ãƒã‚µãƒãƒªãƒ¼ï¼ˆå…¨ä½“ï¼‰/draft_research_summary.md']))}}",
        "{{read_files(find_files(patterns=['**/focus_product_definition.md','**/focus_positioning_statement.md']))}}",
        "{{read_files(find_files(patterns=['**/1_sense/02_é¡§å®¢èª¿æŸ»/sense_customer_research.md']))}}"
      ]
      instructions: |
        Senseã®ã‚ªãƒãƒãƒ¥ãƒ‹ãƒ†ã‚£/ã‚µãƒãƒªãƒ¼/é¡§å®¢èª¿æŸ»ã€ãŠã‚ˆã³Focusã®å®šç¾©ã‹ã‚‰ã€PRã”ã¨ã®è§£æ±ºæ¡ˆå€™è£œãƒ»åŠ¹ããƒ•ã‚§ãƒ¼ã‚ºãƒ»é–¢é€£Aå€™è£œã‚’æŠ½å‡ºã—ã€JSON1ä»¶ã§è¿”ã—ã¦ãã ã•ã„ã€‚
        keys:
          pr1_solution_hint, pr1_phase_hint, pr1_actions_hint,
          pr2_solution_hint, pr2_phase_hint, pr2_actions_hint,
          pr3_solution_hint, pr3_phase_hint, pr3_actions_hint,
          persona_and_problem_hint
      store_as: "sense_focus"
    - name: "prefill_from_yaml"
      action: "display"
      content: |
        ğŸ” å€™è£œï¼ˆè‡ªå‹•æŠ½å‡ºï¼‰
        {{auto_solution_hints}}
        
        ğŸ” Sense/Focus ç”±æ¥ã®å€™è£œ
        - PR1: {{sense_focus.pr1_solution_hint}}ï¼ˆãƒ•ã‚§ãƒ¼ã‚º: {{sense_focus.pr1_phase_hint}}ã€A: {{sense_focus.pr1_actions_hint}}ï¼‰
        - PR2: {{sense_focus.pr2_solution_hint}}ï¼ˆãƒ•ã‚§ãƒ¼ã‚º: {{sense_focus.pr2_phase_hint}}ã€A: {{sense_focus.pr2_actions_hint}}ï¼‰
        - PR3: {{sense_focus.pr3_solution_hint}}ï¼ˆãƒ•ã‚§ãƒ¼ã‚º: {{sense_focus.pr3_phase_hint}}ã€A: {{sense_focus.pr3_actions_hint}}ï¼‰
    
    - name: "show_map_examples"
      action: "display"
      content: |
        ğŸ—ºï¸ PRåŸºæº–ã®è¨­è¨ˆä¾‹ï¼ˆAâ†’PRâ†’SLï¼‰
        - A101 â†’ PR1 â†’ SL1
        - A201 â†’ PR2 â†’ SL2
        - A301 â†’ PR3 â†’ SL3
    
    - name: "collect_solution_map"
      action: "ask_questions_with_template"
      template: |
        === ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—å…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆPRåŸºæº–ï¼‰ ===
        1. ãƒšãƒ«ã‚½ãƒŠã¨èª²é¡Œç¾¤è¦ç´„
        æ—¢å®š: P001 / PR1ãƒ»PR2ãƒ»PR3ï¼ˆproblem_map.yamlï¼‰
        Sense/Focuså€™è£œ: {{sense_focus.persona_and_problem_hint}}
        â†’ ã€ã‚ãªãŸã®å›ç­”ã€‘ï¼š
        
        2. PR1 å‘ã‘ã®è§£æ±ºæ¡ˆï¼ˆåŠ¹ããƒ•ã‚§ãƒ¼ã‚º/é–¢é€£Aå€™è£œ ä»»æ„ï¼‰
        æ—¢å®šå€™è£œ: PR1=æœã®åˆ¤æ–­è¿·ã„ / Aå€™è£œ: A101
        Sense/Focuså€™è£œ: è§£æ±ºæ¡ˆ={{sense_focus.pr1_solution_hint}} / ãƒ•ã‚§ãƒ¼ã‚º={{sense_focus.pr1_phase_hint}} / A={{sense_focus.pr1_actions_hint}}
        â†’ ã€è§£æ±ºæ¡ˆã€‘ï¼š
        â†’ ã€åŠ¹ããƒ•ã‚§ãƒ¼ã‚ºï¼ˆä»»æ„: åˆ©ç”¨å‰/ä¸­/å¾Œï¼‰ã€‘ï¼š
        â†’ ã€é–¢é€£Aï¼ˆä»»æ„: AIDã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ã€‘ï¼š
        
        3. PR2 å‘ã‘ã®è§£æ±ºæ¡ˆï¼ˆåŠ¹ããƒ•ã‚§ãƒ¼ã‚º/é–¢é€£Aå€™è£œ ä»»æ„ï¼‰
        æ—¢å®šå€™è£œ: PR2=æ˜¼ã®å‡¦ç†å¾…ã¡ / Aå€™è£œ: A201
        Sense/Focuså€™è£œ: è§£æ±ºæ¡ˆ={{sense_focus.pr2_solution_hint}} / ãƒ•ã‚§ãƒ¼ã‚º={{sense_focus.pr2_phase_hint}} / A={{sense_focus.pr2_actions_hint}}
        â†’ ã€è§£æ±ºæ¡ˆã€‘ï¼š
        â†’ ã€åŠ¹ããƒ•ã‚§ãƒ¼ã‚ºï¼ˆä»»æ„ï¼‰ã€‘ï¼š
        â†’ ã€é–¢é€£Aï¼ˆä»»æ„ï¼‰ã€‘ï¼š
        
        4. PR3 å‘ã‘ã®è§£æ±ºæ¡ˆï¼ˆåŠ¹ããƒ•ã‚§ãƒ¼ã‚º/é–¢é€£Aå€™è£œ ä»»æ„ï¼‰
        æ—¢å®šå€™è£œ: PR3=å¤œã®é”æˆæ„Ÿä¸è¶³ / Aå€™è£œ: A301
        Sense/Focuså€™è£œ: è§£æ±ºæ¡ˆ={{sense_focus.pr3_solution_hint}} / ãƒ•ã‚§ãƒ¼ã‚º={{sense_focus.pr3_phase_hint}} / A={{sense_focus.pr3_actions_hint}}
        â†’ ã€è§£æ±ºæ¡ˆã€‘ï¼š
        â†’ ã€åŠ¹ããƒ•ã‚§ãƒ¼ã‚ºï¼ˆä»»æ„ï¼‰ã€‘ï¼š
        â†’ ã€é–¢é€£Aï¼ˆä»»æ„ï¼‰ã€‘ï¼š
        =====================================
    
    - name: "wait_inputs"
      action: "wait_for_all_answers"
    
    - name: "spot_mvp_candidates"
      action: "interactive_dialog"
      message: |
        ã„ã„ã§ã™ã­ï¼ 3ã¤ã®è§£æ±ºæ¡ˆã®ä¸­ã‹ã‚‰ã€MVPã§ã¾ãšæ¤œè¨¼ã™ã¹ãé †åºã‚’1â†’3ã§æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆä¾‹: SL2, SL1, SL3ï¼‰ã€‚
    
    # ã“ã“ã‹ã‚‰ï¼šè‡ªå‹•ææ¡ˆ â†’ ä¿®æ­£åé›† â†’ ç¢ºå®šç”Ÿæˆ
    - name: "auto_propose_solution_map_yaml"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map_proposed.yaml"
      content: |
        solution_map:
          persona_ref: P001
          problems: [PR1, PR2, PR3]
          phases:
            - id: PH1
              name: åˆ©ç”¨å‰
              solutions:
                - id: SL1
                  label: {{sl1_label | default:pr1_solution}}
                  links: [PR1, {{sl1_actions | default:"A101"}}]
            - id: PH2
              name: åˆ©ç”¨ä¸­
              solutions:
                - id: SL2
                  label: {{sl2_label | default:pr2_solution}}
                  links: [PR2, {{sl2_actions | default:"A201"}}]
            - id: PH3
              name: åˆ©ç”¨å¾Œ
              solutions:
                - id: SL3
                  label: {{sl3_label | default:pr3_solution}}
                  links: [PR3, {{sl3_actions | default:"A301"}}]
          numbering_policy:
            - prefix: SL=Solution, PH=Phase
    
    - name: "auto_propose_solution_map_mermaid"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map_proposed_mermaid.md"
      content: |
        ```mermaid
        flowchart LR
          {{sl1_actions | default:"A101"}} --> PR1:::problem
          {{sl2_actions | default:"A201"}} --> PR2:::problem
          {{sl3_actions | default:"A301"}} --> PR3:::problem
          PR1:::problem --> SL1[SL1 {{sl1_label | default:pr1_solution}}]:::solution
          PR2:::problem --> SL2[SL2 {{sl2_label | default:pr2_solution}}]:::solution
          PR3:::problem --> SL3[SL3 {{sl3_label | default:pr3_solution}}]:::solution
          classDef problem fill:#ffebee
          classDef solution fill:#e8f5e8
          classDef action fill:#fff3e0
        ```
    
    - name: "display_proposal"
      action: "display"
      content: |
        âœï¸ è‡ªå‹•ææ¡ˆï¼ˆPR1/PR2/PR3ï¼‰ã‚’ `solution_map_proposed.*` ã«å‡ºåŠ›ã—ã¾ã—ãŸã€‚å¿…è¦ãªä¿®æ­£ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç©ºæ¬„ã¯æ¡ç”¨ï¼‰ã€‚
    
    - name: "collect_solution_corrections"
      action: "ask_questions_with_template"
      template: |
        === è¿½åŠ /ä¿®æ­£ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆç©ºæ¬„ã¯æ¡ç”¨ï¼‰ ===
        SL1(PR1) ãƒ©ãƒ™ãƒ«/ãƒªãƒ³ã‚¯ä¿®æ­£
        â†’ ã€ãƒ©ãƒ™ãƒ«ã€‘ï¼š
        â†’ ã€ãƒªãƒ³ã‚¯ï¼ˆä¾‹: PR1,A101ï¼‰ã€‘ï¼š
        
        SL2(PR2) ãƒ©ãƒ™ãƒ«/ãƒªãƒ³ã‚¯ä¿®æ­£
        â†’ ã€ãƒ©ãƒ™ãƒ«ã€‘ï¼š
        â†’ ã€ãƒªãƒ³ã‚¯ã€‘ï¼š
        
        SL3(PR3) ãƒ©ãƒ™ãƒ«/ãƒªãƒ³ã‚¯ä¿®æ­£
        â†’ ã€ãƒ©ãƒ™ãƒ«ã€‘ï¼š
        â†’ ã€ãƒªãƒ³ã‚¯ã€‘ï¼š
        =====================================
    
    - name: "confirm_generate"
      action: "confirm"
      message: "ææ¡ˆï¼‹ä¿®æ­£å†…å®¹ã§æœ€çµ‚æˆæœç‰©ï¼ˆsolution_map.md / solution_map.yaml / solution_map_mermaid.md / ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ä»®èª¬æ–‡ï¼‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
    
    - name: "generate_solution_map"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map_todo.md"
      content: |
        # ã‚¢ãƒ—ãƒª ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—ï¼ˆä»®èª¬ï¼‰
        
        ## å¯¾è±¡ã¨èª²é¡Œï¼ˆPRåŸºæº–ï¼‰
        {{persona_and_problem}}
        
        ## PRåˆ¥ã®è§£æ±ºæ¡ˆ
        - PR1: {{sl1_label_final | default:sl1_label | default:pr1_solution}}
        - PR2: {{sl2_label_final | default:sl2_label | default:pr2_solution}}
        - PR3: {{sl3_label_final | default:sl3_label | default:pr3_solution}}
        
        ## MVPå€™è£œï¼ˆæ¤œè¨¼å„ªå…ˆã®é †ï¼‰
        1. {{mvp_candidate_1}}
        2. {{mvp_candidate_2}}
        3. {{mvp_candidate_3}}
        
        ## ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ä»®èª¬ï¼ˆStatementï¼‰
        > {{solution}} ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå¤šãã®ãŠå®¢æ§˜ãŒ {{behavior_change}} ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ä¿¡ã˜ã¦ã„ã¾ã™ã€‚
    
    - name: "export_solution_map_yaml"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map.yaml"
      content: |
        solution_map:
          persona_ref: P001
          problems: [PR1, PR2, PR3]
          phases:
            - id: PH1
              name: åˆ©ç”¨å‰
              solutions:
                - id: SL1
                  label: {{sl1_label_final | default:sl1_label | default:pr1_solution}}
                  links: [{{sl1_links_final | default:"PR1,A101"}}]
            - id: PH2
              name: åˆ©ç”¨ä¸­
              solutions:
                - id: SL2
                  label: {{sl2_label_final | default:sl2_label | default:pr2_solution}}
                  links: [{{sl2_links_final | default:"PR2,A201"}}]
            - id: PH3
              name: åˆ©ç”¨å¾Œ
              solutions:
                - id: SL3
                  label: {{sl3_label_final | default:sl3_label | default:pr3_solution}}
                  links: [{{sl3_links_final | default:"PR3,A301"}}]
          numbering_policy:
            - prefix: SL=Solution, PH=Phase
    
    - name: "export_solution_map_mermaid"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map_mermaid.md"
      content: |
        ```mermaid
        flowchart LR
          {{sl1_actions | default:"A101"}} --> PR1:::problem
          {{sl2_actions | default:"A201"}} --> PR2:::problem
          {{sl3_actions | default:"A301"}} --> PR3:::problem
          PR1:::problem --> SL1[SL1 {{sl1_label_final | default:sl1_label | default:pr1_solution}}]:::solution
          PR2:::problem --> SL2[SL2 {{sl2_label_final | default:sl2_label | default:pr2_solution}}]:::solution
          PR3:::problem --> SL3[SL3 {{sl3_label_final | default:sl3_label | default:pr3_solution}}]:::solution
          classDef problem fill:#ffebee
          classDef solution fill:#e8f5e8
          classDef action fill:#fff3e0
        ```
    
    - name: "notify_completion"
      action: "display"
      content: |
        âœ… ç”Ÿæˆã—ã¾ã—ãŸï¼š
        - ï¼ˆææ¡ˆï¼‰03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map_proposed.yaml / solution_map_proposed_mermaid.md
        - ï¼ˆç¢ºå®šï¼‰03_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—/solution_map_todo.md / solution_map.yaml / solution_map_mermaid.md / ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ä»®èª¬æ–‡
```

## æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰
â†’ `ä»®èª¬é§†å‹•_ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒãƒƒãƒ—` ã§MVPã‚¹ãƒˆãƒ¼ãƒªãƒ¼åŒ–ã—ã¾ã™
