# 02 ä»®èª¬é§†å‹•: èª²é¡Œå®šç¾©ï¼ˆAIPMãƒãƒƒã‚«ã‚½ãƒ³ï¼‰

## æœ€åˆã«è³ªå•ï¼ˆå®Ÿè¡Œå‰ã«å›ç­”ã—ã¦ãã ã•ã„ï¼‰
- ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã®å›°ã‚Šã”ã¨ï¼ˆæœ€å¤§3ã¤ã€å„1è¡Œï¼‰
  - PH1ã®å›°ã‚Šã”ã¨ï¼ˆå¿…é ˆï¼‰
  - PH2ã®å›°ã‚Šã”ã¨ï¼ˆä»»æ„ï¼‰
  - PH3ã®å›°ã‚Šã”ã¨ï¼ˆä»»æ„ï¼‰
- å„å›°ã‚Šã”ã¨ã®ã€Œãªãœã€Ã—3ï¼ˆä»»æ„ï¼šç©ºæ¬„ãªã‚‰è‡ªå‹•è£œå®Œï¼‰
- å„å›°ã‚Šã”ã¨ã®å½±éŸ¿ï¼ˆæ™‚é–“/é »åº¦/æ³¢åŠï¼‰ï¼ˆä»»æ„ï¼šç©ºæ¬„ãªã‚‰è‡ªå‹•è£œå®Œï¼‰
- ç¾åœ¨ã®å¯¾å‡¦ï¼ˆä»»æ„ï¼‰

> `experience_map.yaml` ã® PHx/Axxx ã‚’å‚ç…§ã—ã€è‡ªå‹•ã§è¡Œå‹•å€™è£œã‚’å¼•ãå½“ã¦ã¾ã™ã€‚

## ç›®çš„
ã‚³ã‚¢èª²é¡Œã®æ¤œè¨ã«åŠ ãˆã€ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã«åˆ†è§£ã—ãŸè¤‡æ•°ã®Problemã‚’Activityã«ç´ã¥ã‘ã¦å¯è¦–åŒ–ã—ã¾ã™ã€‚

## å®Ÿè¡Œæ‰‹é †
```yaml
- trigger: "(ä»®èª¬é§†å‹•_èª²é¡Œå®šç¾©|HypothesisProblem)"
  priority: high
  steps:
    - name: "infer_defaults_from_thread"
      action: "analyze"
      data: ["{{thread_messages}}", "{{read_files(find_files(patterns=['Flow/**/*.yaml','Flow/**/*.md','**/problem_map.yaml','**/customer_problem_map.yaml']))}}"]
      instructions: |
        ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ç›´è¿‘ç”Ÿæˆç‰©ã‹ã‚‰ã€PH1/PH2/PH3ã®å€™è£œã‚„PRè¦ç´„ã®ä¸‹æ›¸ãã‚’æŠ½å‡ºã—ã¦æç¤ºã—ã¦ãã ã•ã„ã€‚
        å‡ºåŠ›ã¯ displayç”¨ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã€ç©ºæ¬„ã¯å«ã‚ãšã«ç°¡æ½”ã«è¦ç‚¹ã®ã¿åˆ—æŒ™ã€‚
      store_as: "auto_phase_hints"

    - name: "ingest_sense_focus"
      action: "analyze"
      data: [
        "{{read_files(find_files(patterns=['**/1_sense/02_é¡§å®¢èª¿æŸ»/sense_customer_research.md']))}}",
        "{{read_files(find_files(patterns=['**/1_sense/05_ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼åˆ†æï¼ˆå€‹åˆ¥ï¼‰/draft_interview_analysis_*.md']))}}",
        "{{read_files(find_files(patterns=['**/1_sense/06_ãƒªã‚µãƒ¼ãƒã‚µãƒãƒªãƒ¼ï¼ˆå…¨ä½“ï¼‰/draft_research_summary.md']))}}",
        "{{read_files(find_files(patterns=['**/1_sense/07_ã‚ªãƒãƒãƒ¥ãƒ‹ãƒ†ã‚£ä»®èª¬æŠ½å‡º/sense_opportunities.yaml']))}}",
        "{{read_files(find_files(patterns=['**/focus_product_definition.md','**/focus_positioning_statement.md']))}}"
      ]
      instructions: |
        é¡§å®¢èª¿æŸ»ãƒ»ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼åˆ†æãƒ»å…¨ä½“ã‚µãƒãƒªãƒ¼ãƒ»ã‚ªãƒãƒãƒ¥ãƒ‹ãƒ†ã‚£ãƒ»ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå®šç¾©ã‹ã‚‰ã€ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥èª²é¡Œã®å€™è£œã‚’æŠ½å‡ºã—ã€JSON1ä»¶ã§è¿”ã—ã¦ãã ã•ã„ã€‚
        keys:
          ph1_summary_hint, ph1_whys_hint, ph1_impact_hint,
          ph2_summary_hint, ph2_whys_hint, ph2_impact_hint,
          ph3_summary_hint, ph3_whys_hint, ph3_impact_hint,
          current_solution_hint
      store_as: "sense_focus"
    - name: "prefill_from_yaml"
      action: "display"
      content: |
        ğŸ” å€™è£œï¼ˆè‡ªå‹•æŠ½å‡ºï¼‰
        {{auto_phase_hints}}
        
        ğŸ” Sense/Focus ç”±æ¥ã®å€™è£œ
        - PH1: {{sense_focus.ph1_summary_hint}}
          - Whyå€™è£œ: {{sense_focus.ph1_whys_hint}}
          - Impactå€™è£œ: {{sense_focus.ph1_impact_hint}}
        - PH2: {{sense_focus.ph2_summary_hint}}
          - Whyå€™è£œ: {{sense_focus.ph2_whys_hint}}
          - Impactå€™è£œ: {{sense_focus.ph2_impact_hint}}
        - PH3: {{sense_focus.ph3_summary_hint}}
          - Whyå€™è£œ: {{sense_focus.ph3_whys_hint}}
          - Impactå€™è£œ: {{sense_focus.ph3_impact_hint}}
        - ç¾åœ¨ã®å¯¾å‡¦å€™è£œ: {{sense_focus.current_solution_hint}}
    
    - name: "collect_phase_problems"
      action: "ask_questions_with_template"
      template: |
        === ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥èª²é¡Œå…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ ===
        1. PH1ã®å›°ã‚Šã”ã¨ï¼ˆ1è¡Œï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph1_summary_hint}}ï¼‰
        â†’
        1-why: ãªãœâ‘  / ãªãœâ‘¡ / ãªãœâ‘¢ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph1_whys_hint}}ï¼‰
        1-impact: å½±éŸ¿ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph1_impact_hint}}ï¼‰
        
        2. PH2ã®å›°ã‚Šã”ã¨ï¼ˆ1è¡Œãƒ»ä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph2_summary_hint}}ï¼‰
        â†’
        2-why: ãªãœâ‘  / ãªãœâ‘¡ / ãªãœâ‘¢ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph2_whys_hint}}ï¼‰
        2-impact: å½±éŸ¿ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph2_impact_hint}}ï¼‰
        
        3. PH3ã®å›°ã‚Šã”ã¨ï¼ˆ1è¡Œãƒ»ä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph3_summary_hint}}ï¼‰
        â†’
        3-why: ãªãœâ‘  / ãªãœâ‘¡ / ãªãœâ‘¢ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph3_whys_hint}}ï¼‰
        3-impact: å½±éŸ¿ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.ph3_impact_hint}}ï¼‰
        
        4. ç¾åœ¨ã®å¯¾å‡¦ï¼ˆä»»æ„ï¼‰
        ï¼ˆå€™è£œ: {{sense_focus.current_solution_hint}}ï¼‰
        â†’
        =====================================
    
    - name: "wait_inputs"
      action: "wait_for_all_answers"
    
    # ææ¡ˆï¼ˆãƒ•ã‚§ãƒ¼ã‚ºåˆ¥PRï¼‰
    - name: "auto_propose_customer_problem_map_yaml"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/customer_problem_map_proposed.yaml"
      content: |
        customer_problem_map:
          persona_ref: P001
          phases:
            - id: PH1
              actions:
                - id: A101
                  thoughts: [{{auto_ph1_thoughts}}]
                  emotions: [{{auto_ph1_emotions}}]
                  issues: [PR1]
            - id: PH2
              actions:
                - id: A201
                  thoughts: [{{auto_ph2_thoughts}}]
                  emotions: [{{auto_ph2_emotions}}]
                  issues: [PR2]
            - id: PH3
              actions:
                - id: A301
                  thoughts: [{{auto_ph3_thoughts}}]
                  emotions: [{{auto_ph3_emotions}}]
                  issues: [PR3]
          problems:
            - id: PR1
              summary: {{ph1_problem_summary}}
              linked_actions: [A101]
              occurs_in_phases: [PH1]
            - id: PR2
              summary: {{ph2_problem_summary | default:""}}
              linked_actions: [A201]
              occurs_in_phases: [PH2]
            - id: PR3
              summary: {{ph3_problem_summary | default:""}}
              linked_actions: [A301]
              occurs_in_phases: [PH3]
          numbering_policy:
            - prefix: PH=Phase, A=Action, PR=Problem
    
    - name: "auto_propose_customer_problem_map_mermaid"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/customer_problem_map_proposed_mermaid.md"
      content: |
        ```mermaid
        flowchart TD
          subgraph PH1[ãƒ•ã‚§ãƒ¼ã‚º1]
            A101[è¡Œå‹•: A101]
            A101 --> PR1[PR1 {{ph1_problem_summary}}]
          end
          subgraph PH2[ãƒ•ã‚§ãƒ¼ã‚º2]
            A201[è¡Œå‹•: A201]
            A201 --> PR2[PR2 {{ph2_problem_summary}}]
          end
          subgraph PH3[ãƒ•ã‚§ãƒ¼ã‚º3]
            A301[è¡Œå‹•: A301]
            A301 --> PR3[PR3 {{ph3_problem_summary}}]
          end
        ```
    
    - name: "display_proposal"
      action: "display"
      content: |
        âœï¸ è‡ªå‹•æ¨æ¸¬ï¼ˆPR1/PR2/PR3ï¼‰ã‚’å‡ºåŠ›ã—ã¾ã—ãŸã€‚ä¿®æ­£ç‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç©ºæ¬„ã¯æ¡ç”¨ï¼‰ã€‚
    
    - name: "collect_mapping_corrections"
      action: "ask_questions_with_template"
      template: |
        === è¿½åŠ /ä¿®æ­£ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆç©ºæ¬„ã¯æ¡ç”¨ï¼‰ ===
        PH1: è¦ç´„/whyÃ—3/impact/ãƒªãƒ³ã‚¯AID
        â†’
        PH2: è¦ç´„/whyÃ—3/impact/ãƒªãƒ³ã‚¯AID
        â†’
        PH3: è¦ç´„/whyÃ—3/impact/ãƒªãƒ³ã‚¯AID
        â†’
        =====================================
    
    - name: "confirm_generate"
      action: "confirm"
      message: "ææ¡ˆï¼‹ä¿®æ­£ã§æœ€çµ‚æˆæœç‰©ã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆphaseåˆ¥PRã‚’å«ã‚€ï¼‰ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
    
    - name: "export_customer_problem_map_yaml"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/customer_problem_map.yaml"
      content: |
        customer_problem_map:
          persona_ref: P001
          phases:
            - id: PH1
              actions:
                - id: A101
                  thoughts: [{{ph1_thoughts_final | default:auto_ph1_thoughts}}]
                  emotions: [{{ph1_emotions_final | default:auto_ph1_emotions}}]
                  issues: [PR1]
            - id: PH2
              actions:
                - id: A201
                  thoughts: [{{ph2_thoughts_final | default:auto_ph2_thoughts}}]
                  emotions: [{{ph2_emotions_final | default:auto_ph2_emotions}}]
                  issues: [PR2]
            - id: PH3
              actions:
                - id: A301
                  thoughts: [{{ph3_thoughts_final | default:auto_ph3_thoughts}}]
                  emotions: [{{ph3_emotions_final | default:auto_ph3_emotions}}]
                  issues: [PR3]
          problems:
            - id: PR1
              summary: {{ph1_problem_summary_final | default:ph1_problem_summary}}
              causes: [{{ph1_why1}}, {{ph1_why2}}, {{ph1_why3}}]
              impact: {{ph1_impact}}
              linked_actions: [{{ph1_linked_actions_final | default:"A101"}}]
              occurs_in_phases: [PH1]
            - id: PR2
              summary: {{ph2_problem_summary_final | default:ph2_problem_summary}}
              causes: [{{ph2_why1}}, {{ph2_why2}}, {{ph2_why3}}]
              impact: {{ph2_impact}}
              linked_actions: [{{ph2_linked_actions_final | default:"A201"}}]
              occurs_in_phases: [PH2]
            - id: PR3
              summary: {{ph3_problem_summary_final | default:ph3_problem_summary}}
              causes: [{{ph3_why1}}, {{ph3_why2}}, {{ph3_why3}}]
              impact: {{ph3_impact}}
              linked_actions: [{{ph3_linked_actions_final | default:"A301"}}]
              occurs_in_phases: [PH3]
          numbering_policy:
            - prefix: PH=Phase, A=Action, PR=Problem
    
    - name: "export_customer_problem_map_mermaid"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/customer_problem_map_mermaid.md"
      content: |
        ```mermaid
        flowchart TD
          subgraph PH1[ãƒ•ã‚§ãƒ¼ã‚º1]
            A101[è¡Œå‹•: A101]
            A101 --> PR1[PR1 {{ph1_problem_summary_final | default:ph1_problem_summary}}]
          end
          subgraph PH2[ãƒ•ã‚§ãƒ¼ã‚º2]
            A201[è¡Œå‹•: A201]
            A201 --> PR2[PR2 {{ph2_problem_summary_final | default:ph2_problem_summary}}]
          end
          subgraph PH3[ãƒ•ã‚§ãƒ¼ã‚º3]
            A301[è¡Œå‹•: A301]
            A301 --> PR3[PR3 {{ph3_problem_summary_final | default:ph3_problem_summary}}]
          end
        ```
    
    - name: "generate_problem_statement"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/problem_todo.md"
      content: |
        # ã‚¢ãƒ—ãƒª èª²é¡Œå®šç¾©ï¼ˆä»®èª¬ï¼‰
        
        ## ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã®ä¸»è¦èª²é¡Œ
        - PH1 â†’ PR1: {{ph1_problem_summary_final | default:ph1_problem_summary}}
        - PH2 â†’ PR2: {{ph2_problem_summary_final | default:ph2_problem_summary}}
        - PH3 â†’ PR3: {{ph3_problem_summary_final | default:ph3_problem_summary}}
        
        ## ç¾çŠ¶ã®å¯¾å‡¦ã¨é™ç•Œ
        {{current_solution}}
    
    - name: "export_problem_map_yaml"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/problem_map.yaml"
      content: |
        problem_map:
          persona_ref: P001
          problems:
            - id: PR1
              summary: {{ph1_problem_summary_final | default:ph1_problem_summary}}
              causes: [{{ph1_why1}}, {{ph1_why2}}, {{ph1_why3}}]
              impact: {{ph1_impact}}
              linked_actions: [{{ph1_linked_actions_final | default:"A101"}}]
              occurs_in_phases: [PH1]
            - id: PR2
              summary: {{ph2_problem_summary_final | default:ph2_problem_summary}}
              causes: [{{ph2_why1}}, {{ph2_why2}}, {{ph2_why3}}]
              impact: {{ph2_impact}}
              linked_actions: [{{ph2_linked_actions_final | default:"A201"}}]
              occurs_in_phases: [PH2]
            - id: PR3
              summary: {{ph3_problem_summary_final | default:ph3_problem_summary}}
              causes: [{{ph3_why1}}, {{ph3_why2}}, {{ph3_why3}}]
              impact: {{ph3_impact}}
              linked_actions: [{{ph3_linked_actions_final | default:"A301"}}]
              occurs_in_phases: [PH3]
          numbering_policy:
            - prefix: PR=Problem, A=Action
    
    - name: "export_problem_map_mermaid"
      action: "create_markdown_file"
      path: "Flow/{{today}}/{{flow_dir}}/02_èª²é¡Œå®šç¾©/problem_map_mermaid.md"
      content: |
        ```mermaid
        flowchart TD
          subgraph PH1[ãƒ•ã‚§ãƒ¼ã‚º1]
            A101[è¡Œå‹•: A101]
            A101 --> PR1[PR1 {{ph1_problem_summary_final | default:ph1_problem_summary}}]
          end
          subgraph PH2[ãƒ•ã‚§ãƒ¼ã‚º2]
            A201[è¡Œå‹•: A201]
            A201 --> PR2[PR2 {{ph2_problem_summary_final | default:ph2_problem_summary}}]
          end
          subgraph PH3[ãƒ•ã‚§ãƒ¼ã‚º3]
            A301[è¡Œå‹•: A301]
            A301 --> PR3[PR3 {{ph3_problem_summary_final | default:ph3_problem_summary}}]
          end
          classDef phase fill:#f9d71c
          classDef action fill:#fff9c4
          classDef problem fill:#5fb3d4
          class PH1,PH2,PH3 phase
          class A101,A201,A301 action
          class PR1,PR2,PR3 problem
        ```
    
    - name: "notify_completion"
      action: "display"
      content: |
        âœ… ç”Ÿæˆã—ã¾ã—ãŸï¼š
        - 02_èª²é¡Œå®šç¾©/customer_problem_map_proposed.yaml / customer_problem_map_proposed_mermaid.md
        - 02_èª²é¡Œå®šç¾©/customer_problem_map.yaml
        - 02_èª²é¡Œå®šç¾©/problem_map.yaml / problem_map_mermaid.md
        - 02_èª²é¡Œå®šç¾©/problem_todo.md
```

## æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰
â†’ `ä»®èª¬é§†å‹•_ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ—` ã§è§£æ±ºç­–ã‚’æ§‹é€ åŒ–ã—ã¾ã™
